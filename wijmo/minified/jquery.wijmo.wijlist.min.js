/*
 *
 * Wijmo Library 2.3.4
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/widgets/license/
 *
 **/
(function(a){"use strict";var g="ui-widget ui-widget-content ui-corner-all wijmo-wijlist",c="wijmo-wijlist-item",h=c+"-alternate",i=c+"-selected",j=c+"-first",k=c+"-last",f="ui-state-hover",l="ui-state-active",e="wijmo-wijlistitem-active",b=i+" "+l,d="item.wijlist";a.widget("wijmo.wijlist",{options:{dataSource:null,listItems:[],selected:null,selectionMode:"single",autoSize:false,maxItemsCount:5,addHoverItemClass:true,superPanelOptions:null,disabled:false,focusing:null,focus:null,blur:null,itemRendering:null,itemRendered:null,listRendered:null,keepHightlightOnMouseLeave:false},removeAll:function(){var a=this;a.items=[];a._refresh()},addItem:function(c,b){var a=this;a._checkData();if(b===null||b===undefined)a.items.push(c);else a.items&&a.items.splice(b,0,c);a._refresh()},removeItem:function(c){var b=this,a;b._checkData();a=b.indexOf(c);a>=0&&b.removeItemAt(a)},indexOf:function(e){var c=this,d=-1,a=0,b;c._checkData();for(a=0;a<c.items.length;a++){b=c.items[a];if(b.label===e.label&&b.value===e.value){d=a;break}}return d},findIndexByLabel:function(c){var d=this,b=-1,a=0,e;if(c===null||c===undefined)return b;d._checkData();for(a=0;a<d.items.length;a++){e=d.items[a];if(e.label===c){b=a;break}}return b},removeItemAt:function(b){var a=this;a._checkData();a.items.splice(b,1);a._refresh()},_checkData:function(){var a=this;if(!a.items)a.items=[]},_refresh:function(){var a=this;a.renderList();a.refreshSuperPanel()},_setOption:function(d,h){var c=this,e,g,f;a.Widget.prototype._setOption.apply(c,arguments);if(d==="disabled")c._handleDisabledOption(h,c.element);else if(d==="selectionMode"){e=c.selectedItem;if(e){e.selected=false;e.element&&e.element.removeClass(b);c.selectedItem=undefined}a.each(c.selectedItems,function(c,a){a.selected=false;a.element.removeClass(b)});c.selectedItem=[]}else if(d==="listItems"){g=c._isBind();if(g){f=c._getRenderItems();c.setItems(f)}else c.setItems(h);c.renderList();c.refreshSuperPanel()}else if(d==="dataSource"){g=c._isBind();if(g){f=c._getRenderItems();c.setItems(f);c.renderList();c.refreshSuperPanel()}}else(d==="autoSize"||d==="maxItemsCount")&&c.refreshSuperPanel()},_create:function(){var b=this,c=this.element,f=this.options,d;if(window.wijmoApplyWijTouchUtilEvents)a=window.wijmoApplyWijTouchUtilEvents(a);c.addClass(g).attr({role:"listbox","aria-activedescendant":e,"aria-multiselectable":f.selectionMode==="multiple"}).bind("click."+b.widgetName,b,b._onListClick);if(c.is("div")&&c.children().is("ul")){b._isInnerData=true;b._templates=[];a.each(a("ul > li",c),function(c,a){b._templates.push({templateHtml:a.innerHTML})});b._oriChildren=c.children().hide()}b.ul=a("<ul class='wijmo-wijlist-ul'></ul>").appendTo(c);if(f.listItems!==null){d=b._getRenderItems();if(d){b.setItems(d);b.renderList();b.refreshSuperPanel()}}b.element.is(":hidden")&&b.element.wijAddVisibilityObserver&&b.element.wijAddVisibilityObserver(function(){b.refreshSuperPanel();b.element.wijRemoveVisibilityObserver&&b.element.wijRemoveVisibilityObserver()},"wijlist");f.disabled&&b.disable()},_isBind:function(){var b=this.options,a=b.listItems;return a!==null&&a.label&&a.label.bind?true:false},_getRenderItems:function(){var c=this.options,b=c.listItems;return b!==null?a.isArray(b)&&b.length>0&&typeof b[0].label==="string"?b:b.label&&b.label.bind?this._getMappingItems():null:null},_getMappingItems:function(){var g=this.options,c=g.dataSource,b=g.listItems,d,e,f;if(!c||!b)return null;if(!b.label||!b.label.bind||!b.value||!b.value.bind)return null;e=b.label.bind;f=b.value.bind;if(c&&c.length!==0){d=[];a.each(c,function(b,a){d.push({label:a[e],value:a[f]})});return d}return null},_handleDisabledOption:function(b,c){var a=this;if(b){if(!a.disabledDiv)a.disabledDiv=a._createDisabledDiv(c);a.disabledDiv.appendTo("body")}else if(a.disabledDiv){a.disabledDiv.remove();a.disabledDiv=null}},_createDisabledDiv:function(f){var g=this,b=f||g.element,c=b.offset(),e=b.outerWidth(),d=b.outerHeight();return a("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:e,height:d,left:c.left,top:c.top})},setTemplateItems:function(a){this._setItemsByExtend(a,true)},setItems:function(a){this._setItemsByExtend(a,false)},_setItemsByExtend:function(c,e){var b=this,d;if(e){if(b._templates&&c&&c.length!==b._templates.length)return;b.items=c;if(!b.items)b.items=[];a.each(b._templates,function(a){if(b.items[a])b.items[a].templateHtml=b._templates[a].templateHtml;else b.items.push({templateHtml:b._templates[a].templateHtml,label:c[a].label,value:c[a].value})})}else b.items=c;if(!c)return null;d=a.grep(c,function(a){return a.selected});if(b.options.selectionMode==="single"){b.selectedItems=[];b.selectedItem=d.length>0?d[0]:undefined}else b.selectedItems=d},filterItems:function(g,l,k){var c=this,e=c._escapeRegex(g),i,d,j="",n=null,f=false,h=null;if(!this.items)return null;if(a("li[wijhidden].wijmo-wijlist-item",c.element)&&a("li[wijhidden].wijmo-wijlist-item",c.element).length>0)f=true;if(a("span.ui-priority-primary",c.element)&&a("span.ui-priority-primary",c.element).length>0)f=true;if(!f&&(!g||g.length===0)){a.each(this.items,function(d,a){if(a.selected){c.activate(null,a,false);a.element&&a.element.addClass(b);c.selectedItem=a}else a.element&&a.element.hasClass(b)&&a.element.removeClass(b)});return}i=new RegExp(e,"i");a.each(this.items,function(m,f){d=f.label;if(f.templateHtml)d=f.templateHtml;else if(f.text!==undefined)d=f.text;a("span.ui-priority-primary",f.element).length>0&&f.element.empty().append(d);var g=i.exec(f.label);if(g===null&&l){f.element.hide();f.element.attr("wijhidden","wijhidden")}else{if(f.selected){c.activate(null,f,false);f.element.addClass(b);c.selectedItem=f}else f.element.hasClass(b)&&f.element.removeClass(b);if(k){j=d.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e+")(?![^<>]*>)(?![^&;]+;)","gi"),"<span class='ui-priority-primary'>$1</span>");f.element.html(j)}if(!f.element.is(":visible")){f.element.show();f.element.removeAttr("wijhidden")}if(e!==undefined&&e.length!==0&&h===null&&g&&g.index===0)h=f}});return h},popItem:function(){var a=this;a._checkData();a.items.pop();a._refresh()},getList:function(){return this.ul},_onListClick:function(b){if(!a(b.target).closest(".wijmo-wijlist-item").length)return;var c=b.data;c.select(b)},destroy:function(){var b=this,c=this.element;b.superPanel!==undefined&&b.superPanel.destroy();c.removeClass("wijmo-wijobserver-visibility").removeClass(g).removeAttr("role").removeAttr("aria-activedescendant").unbind("."+b.widgetName);b.ul.remove();if(b.disabledDiv){b.disabledDiv.remove();b.disabledDiv=null}b._isInnerData&&b._oriChildren.show();a.Widget.prototype.destroy.apply(b,arguments)},activate:function(d,b,g){var a=this,h,c;a.deactivate();if(b===null||b===undefined)return;if(a._trigger("focusing",d,b)===false)return;h=a.active=b;c=b.element;if(c){a.options.addHoverItemClass&&c.addClass(f);c.attr("id",e)}g&&a.superPanel!==undefined&&a.superPanel.scrollChildIntoView(c);a.element.is(":visible")&&a._trigger("focus",d,b)},deactivate:function(){var a=this,c=a.active,b;if(!c)return;b=c.element;a._trigger("blur",null,c);b&&b.removeClass(f).removeAttr("id");a.active=undefined},next:function(a){this.move("next","."+c+":first",a)},nextPage:function(){this.superPanel.doScrolling("bottom",true)},previous:function(a){this.move("prev","."+c+":last",a)},previousPage:function(){this.superPanel.doScrolling("top",true)},first:function(){return this.active&&!this.active.element.prev().length},last:function(){return this.active&&!this.active.element.next().length},move:function(h,f,b){var a=this,g,e;if(!a.active){g=a.ul.children(":visible"+f).data(d);a.activate(b,g,true);return}e=a.active.element[h+"All"](":visible."+c).eq(0);if(e.length)a.activate(b,e.data(d),true);else a.activate(b,a.element.children(f).data(d),true)},select:function(j,k){var e=this,g,h,c,i,f;if(e.active===undefined)return;g=e.active.element;if(g===undefined||g.attr("wijhidden"))return;c=g.data(d);if(!c)return;i=e.options.selectionMode==="single";if(i){f=e.selectedItem;g.addClass(b).attr("aria-selected","true");c.selected=true;if(f!==undefined&&c!==f){f.selected=false;f.element&&f.element.removeClass(b).removeAttr("aria-selected")}e.selectedItem=c;h=a.inArray(c,e.items);e._trigger("selected",j,{item:c,previousItem:f,selectedIndex:h,data:k})}else{c.selected=!c.selected;if(c.selected)g.addClass(b).attr("aria-selected","true");else g.removeClass(b).removeAttr("aria-selected","true");h=[];e.selectedItems=a.grep(e.items,function(a,b){a.selected&&h.push(b);return a.selected});e._trigger("selected",j,{selectedIndex:h,item:c,selectedItems:e.selectedItems})}},_findItemsByValues:function(c){var b,d=[];d=a.grep(this.items,function(d){b=false;for(var a=0;a<c.length;a++)if(d.value===c[a])b=true;return b});return d},_findItemsByIndices:function(c){var d=this,e=this.items.length,b=[];a.each(c,function(c,a){a>=0&&a<e&&b.push(d.items[a])});return b},getItems:function(b){var g=this,f,c,d,e;c=a.isArray(b);f=!c&&typeof b==="number"||c&&typeof b[0]==="number";d=c?b:[b];e=f?g._findItemsByIndices(d):g._findItemsByValues(d);return e},selectItems:function(i,g){var c=this,h=this.options.selectionMode==="single",e,d,f;f=c.getItems(i);if(h){if(f.length>0){e=f[0];e.selected=true;e.element.addClass(b)}d=c.selectedItem;if(d){d.selected=false;d.element.removeClass(b)}c.selectedItem=e;g&&c._trigger("selected",null,{item:e,previousItem:d})}else{a.each(f,function(c,a){a.selected=true;a.element.addClass(b)});c.selectedItems=a.grep(c.items,function(a){return a.selected});g&&c._trigger("selected",null,{selectedItems:c.selectedItems})}},unselectItems:function(f){var c=this,g=this.options.selectionMode,d,e;if(g==="single"){d=c.selectedItem;if(d){d.selected=false;d.element.removeClass(b);c.selectedItem=undefined}}else{e=c.getItems(f);a.each(e,function(c,a){a.selected=false;a.element.removeClass(b)});c.selectedItems=a.grep(c.items,function(a){return a.selected})}},renderList:function(){var e=this,g=this.ul,l=this.options,b,c,h,d,i,f;g.empty();b=e.items;if(b===undefined)return;c=b.length;if(b===undefined||b===null&&c===0)return;h=l.selectionMode==="single";f=[];for(d=0;d<c;d++){i=b[d];f.push(e._renderItem(g,i,d,h))}a(f).appendTo(g);if(c>0){b[0].element&&b[0].element.addClass(j);b[c-1].element&&b[c-1].element.addClass(k)}e._trigger("listRendered",null,e)},_renderItem:function(l,c,j){var e=this,f=a("<li role='option' class='wijmo-wijlist-item ui-corner-all'></li>"),g,i;c.element=f;c.list=e;if(e._trigger("itemRendering",null,c)===false)return;g=c.label;c.title&&f.attr("title",c.title);if(c.templateHtml)g=c.templateHtml;else if(c.text!==undefined)g=c.text;f.bind("mouseover",function(a){e.activate(a,c,false)}).bind("mouseout",function(){!e.options.keepHightlightOnMouseLeave&&e.deactivate()}).data(d,c).append(g);if(!e._isInnerData){i=c.imageUrl;i!==undefined&&i.length>0&&f.prepend("<img src='"+c.imageUrl+"'>")}if(c.selected){e.activate(null,c,false);f.addClass(b)}j%2===1&&f.addClass(h);e._trigger("itemRendered",null,c);return f},_escapeRegex:function(a){return a===undefined?a:a.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},adjustOptions:function(){var b=this.options,a;if(b.data!==null)for(a=0;a<b.listItems.length;a++){delete b.listItems[a].element;delete b.listItems[a].list}return b},refreshSuperPanel:function(){var b=this,c=this.element,p=this.options,d=this.ul,q=d.children(".wijmo-wijlist-item:first"),g,f,j,k=null,i,m,n,e,h,l,o;if(!c.is(":visible"))return false;f=d.outerHeight();j=c.innerWidth();if(p.autoSize)k=q.outerHeight(true)*p.maxItemsCount;k!==null&&c.height(Math.min(k,f));i=c.innerHeight();m=i/(f-i);h=101*m/(1+m);n=q.outerHeight()/(f-i)*(101-h);if(b.superPanel===undefined){l={allowResize:false,keyboardSupport:false,bubbleScrollingEvent:true,hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollSmallChange:n,scrollLargeChange:h}};a.extend(l,p.superPanelOptions);b.superPanel=c.wijsuperpanel(l).data("wijsuperpanel");if(b.superPanel.vNeedScrollBar){d.setOutWidth(j-18);b.superPanel.refresh()}}else{e=b.superPanel.options.vScroller;e.scrollLargeChange=h;e.scrollSmallChange=n;b.superPanel.paintPanel();if(b.superPanel.vNeedScrollBar){d.setOutWidth(j-18);b.superPanel.refresh()}else{d.setOutWidth(c.outerWidth());g=c.children(".wijmo-wijsuperpanel-header").outerHeight();g!==null&&g!==undefined&&c.height(f+g);b.superPanel.refresh()}}o=d.css("padding-top");if(o.length>0){e=b.superPanel.options.vScroller;e.firstStepChangeFix=b.superPanel.scrollPxToValue(parseFloat(o),"v")}else e.firstStepChangeFix=0;d.setOutWidth(d.parent().parent().innerWidth())}})})(jQuery);