/*
 *
 * Wijmo Library 2.2.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijslider",a.ui.slider,{options:{buttonMouseOver:null,buttonMouseOut:null,buttonMouseDown:null,buttonMouseUp:null,buttonClick:null,dragFill:true,minRange:0},_setOption:function(d,c){var b=this;a.ui.slider.prototype._setOption.apply(b,arguments);this.options[d]=c;if(d==="disabled")b._handleDisabledOption(c,b.element.parent());else d==="range"&&b._setRangeOption(c);return this},_setRangeOption:function(d){var c=this,b=c.options;if(d){if(d===true){if(!b.values)b.values=[c._valueMin(),c._valueMin()];if(b.values.length&&b.values.length!==2)b.values=[b.values[0],b.values[0]]}c.range=a("<div></div>").appendTo(c.element).addClass("ui-slider-range ui-widget-header"+(b.range==="min"||b.range==="max"?" ui-slider-range-"+b.range:""))}else c.range.remove();c._refreshValue()},_create:function(){var b=this,c=b.element,d=b.options,i,l,e,g,h,n,m,f,j,k,o;if(window.wijmoApplyWijTouchUtilEvents)a=window.wijmoApplyWijTouchUtilEvents(a);b._oriStyle=c.attr("style");if(c.is(":input")){if(d.orientation==="horizontal")i=a("<div></div>").width(c.width()).appendTo(document.body);else i=a("<div></div>").height(c.height()).appendTo(document.body);l=c.val();if(l!=="")try{e=l.split(";");h=e.length;if(h>0){for(g=0;g<h;g++)e[g]=parseInt(e[g],10);if(h===1)d.value=e[0];else d.values=e}}catch(q){}c.data(b.widgetName,i.wijslider(d)).after(a(document.body).children("div:last")).hide();if(d.disabledState){var p=d.disabled;b.disable();d.disabled=p}return}a.ui.slider.prototype._create.apply(b,arguments);c.data("originalStyle",c.attr("style"));c.data("originalContent",c.html());n=c.width();m=c.height();f=a("<div></div>");if(d.orientation==="horizontal")f.addClass("wijmo-wijslider-horizontal");else f.addClass("wijmo-wijslider-vertical");f.width(n).height(m);j=a('<a class="wijmo-wijslider-decbutton"><span></span></a>');k=a('<a class="wijmo-wijslider-incbutton"><span></span></a>');c.wrap(f).before(j).after(k);b._container=c.parent();b._attachClass();o=c.find(".ui-slider-handle");b._adjustSliderLayout(j,k,o);if(d.disabledState){var p=d.disabled;b.disable();d.disabled=p}b.element.is(":hidden")&&b.element.wijAddVisibilityObserver&&b.element.wijAddVisibilityObserver(function(){b._refresh();b.element.wijRemoveVisibilityObserver&&b.element.wijRemoveVisibilityObserver()},"wijslider");b._bindEvents()},_handleDisabledOption:function(b,c){var a=this;if(b){if(!a.disabledDiv)a.disabledDiv=a._createDisabledDiv(c);a.disabledDiv.appendTo("body")}else if(a.disabledDiv){a.disabledDiv.remove();a.disabledDiv=null}},_createDisabledDiv:function(d){var g=this,b=d?d:g.element,c=b.offset(),f=b.outerWidth(),e=b.outerHeight();return a("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:f,height:e,left:c.left,top:c.top})},_refresh:function(){var a=this,c,b,d;b=a._container.find(".wijmo-wijslider-decbutton");c=a._container.find(".wijmo-wijslider-incbutton");d=a._container.find(".ui-slider-handle");a._adjustSliderLayout(b,c,d);a._refreshValue()},_adjustSliderLayout:function(e,f,q){var h=this,g=h.element,r=h.options,b,a,d,c,j,i,l,k,o,p,m,n;b=h._container.width();a=h._container.height();d=e.outerWidth();c=e.outerHeight();j=f.outerWidth();i=f.outerHeight();l=q.outerWidth();k=q.outerHeight();if(r.orientation==="horizontal"){o=a/2-c/2;e.css("top",o).css("left",0);p=a/2-i/2;f.css("top",p).css("right",0);g.css("left",d+l/2-1).css("top",a/2-g.outerHeight()/2).width(b-d-j-l-2)}else{m=b/2-d/2;e.css("left",m).css("top",0);n=b/2-j/2;f.css("left",n).css("bottom",0);g.css("left",b/2-g.outerWidth()/2).css("top",c+k/2+1).height(a-c-i-k-2)}},destroy:function(){var b=this,c,d;c=this._getDecreBtn();d=this._getIncreBtn();c.unbind("."+b.widgetName);d.unbind("."+b.widgetName);a.ui.slider.prototype.destroy.apply(this,arguments);a("a",b.element.parent()).remove();b.element.unbind("."+b.widgetName);b.element.unwrap();if(b._oriStyle===undefined)b.element.removeAttr("style");else b.element.attr("style",b._oriStyle);b.element.removeData(b.widgetName).removeData("originalStyle").removeData("originalContent");if(b.disabledDiv){b.disabledDiv.remove();b.disabledDiv=null}},_slide:function(i,f,e){var g=this,h=g.options,c=h.minRange,d=e,b;if(h.range){b=g.values();if(f===0&&b[1]-c<e)d=b[1]-c;else if(f===1&&b[0]+c>e)d=b[0]+c}a.ui.slider.prototype._slide.call(g,i,f,d)},_getDecreBtn:function(){return this.element.parent().find(".wijmo-wijslider-decbutton")},_getIncreBtn:function(){return this.element.parent().find(".wijmo-wijslider-incbutton")},_attachClass:function(){this._getDecreBtn().addClass("ui-corner-all ui-state-default").attr("role","button");this._getIncreBtn().addClass("ui-corner-all ui-state-default").attr("role","button");this.element.parent().attr("role","slider").attr("aria-valuemin",this.options.min).attr("aria-valuenow","0").attr("aria-valuemax",this.options.max);if(this.options.orientation==="horizontal"){this.element.parent().addClass("wijmo-wijslider-horizontal");this._getDecreBtn().find("> span").addClass("ui-icon ui-icon-triangle-1-w");this._getIncreBtn().find("> span").addClass("ui-icon ui-icon-triangle-1-e")}else{this.element.parent().addClass("wijmo-wijslider-vertical");this._getDecreBtn().find("> span").addClass("ui-icon ui-icon-triangle-1-n");this._getIncreBtn().find("> span").addClass("ui-icon ui-icon-triangle-1-s")}},_bindEvents:function(){var a=this,b,c;b=this._getDecreBtn();c=this._getIncreBtn();b.bind("click."+a.widgetName,a,a._decreBtnClick);c.bind("click."+a.widgetName,a,a._increBtnClick);b.bind("mouseover."+a.widgetName,a,a._decreBtnMouseOver);b.bind("mouseout."+a.widgetName,a,a._decreBtnMouseOut);b.bind("mousedown."+a.widgetName,a,a._decreBtnMouseDown);b.bind("mouseup."+a.widgetName,a,a._decreBtnMouseUp);c.bind("mouseover."+a.widgetName,a,a._increBtnMouseOver);c.bind("mouseout."+a.widgetName,a,a._increBtnMouseOut);c.bind("mousedown."+a.widgetName,a,a._increBtnMouseDown);c.bind("mouseup."+a.widgetName,a,a._increBtnMouseUp)},_decreBtnMouseOver:function(d){var a=d.data,c,b;if(a.options.disabledState)return;c={buttonType:"decreButton"};a._trigger("buttonMouseOver",d,c);b=a._getDecreBtn();b.addClass("ui-state-hover")},_increBtnMouseOver:function(d){var a=d.data,c,b;if(a.options.disabledState)return;c={buttonType:"increButton"};a._trigger("buttonMouseOver",d,c);b=a._getIncreBtn();b.addClass("ui-state-hover")},_decreBtnMouseOut:function(d){var a=d.data,c,b;if(a.options.disabledState)return;c={buttonType:"decreButton"};a._trigger("buttonMouseOut",d,c);b=a._getDecreBtn();b.removeClass("ui-state-hover ui-state-active")},_increBtnMouseOut:function(d){var a=d.data,c,b;if(a.options.disabledState)return;c={buttonType:"increButton"};a._trigger("buttonMouseOut",d,c);b=a._getIncreBtn();b.removeClass("ui-state-hover ui-state-active")},_decreBtnMouseDown:function(e){var b=e.data,d,c;if(b.options.disabledState)return;d={buttonType:"decreButton"};b._trigger("buttonMouseDown",e,d);c=b._getDecreBtn();c.addClass("ui-state-active");a(document).bind("mouseup."+b.widgetName,{self:b,ele:c},b._documentMouseUp);if(b._intervalID!==null){window.clearInterval(b._intervalID);b._intervalID=null}b._intervalID=window.setInterval(function(){b._decreBtnHandle(b)},200)},_documentMouseUp:function(c){var b=c.data.self,d=c.data.ele;if(b.options.disabledState)return;d.removeClass("ui-state-active");if(b._intervalID!==null){window.clearInterval(b._intervalID);b._intervalID=null}a(document).unbind("mouseup."+b.widgetName,b._documentMouseUp)},_intervalID:null,_increBtnMouseDown:function(e){var b=e.data,d,c;if(b.options.disabledState)return;d={buttonType:"increButton"};b._trigger("buttonMouseDown",e,d);c=b._getIncreBtn();c.addClass("ui-state-active");a(document).bind("mouseup."+b.widgetName,{self:b,ele:c},b._documentMouseUp);if(b._intervalID!==null){window.clearInterval(b._intervalID);b._intervalID=null}b._intervalID=window.setInterval(function(){b._increBtnHandle(b)},200)},_decreBtnMouseUp:function(d){var a=d.data,c,b;if(a.options.disabledState)return;c={buttonType:"decreButton"};a._trigger("buttonMouseUp",d,c);b=a._getDecreBtn();b.removeClass("ui-state-active");window.clearInterval(a._intervalID)},_increBtnMouseUp:function(d){var a=d.data,c,b;if(a.options.disabledState)return;c={buttonType:"increButton"};a._trigger("buttonMouseUp",d,c);b=a._getIncreBtn();b.removeClass("ui-state-active");window.clearInterval(a._intervalID)},_decreBtnHandle:function(a){if(a.options.orientation==="horizontal")a._decre();else a._incre()},_decreBtnClick:function(c){var a=c.data,b;if(a.options.disabledState)return;a._mouseSliding=false;a._decreBtnHandle(a);b={buttonType:"decreButton",value:a.value()};a._trigger("buttonClick",c,b)},_increBtnHandle:function(a){if(a.options.orientation==="horizontal")a._incre();else a._decre()},_increBtnClick:function(c){var a=c.data,b;if(a.options.disabledState)return;a._mouseSliding=false;a._increBtnHandle(a);b={buttonType:"increButton",value:a.value()};a._trigger("buttonClick",c,b)},_decre:function(){var a=this.value();if(!this.options.range&&!this.options.values){a=this.value();if(a<=this.options.min)this.value(this.options.min);else this.value(a-this.options.step)}else{a=this.values(0);if(a<=this.options.min)this.values(0,this.options.min);else this.values(0,a-this.options.step)}this.element.parent().attr("aria-valuenow",this.value())},_incre:function(){var a=this.value();if(!this.options.range&&!this.options.values){a=this.value();if(a>=this.options.max)this.value(this.options.max);else this.value(a+this.options.step)}else{a=this.values(1);if(a>=this.options.max)this.values(1,this.options.max);else this.values(1,a+this.options.step)}this.element.parent().attr("aria-valuenow",this.value())},_mouseInit:function(){var b=this;if(this.options.dragFill&&this.options.range){this._preventClickEvent=false;this.element.bind("click."+b.widgetName,function(){if(b._dragFillStart>0)b._dragFillStart=0;else a.ui.slider.prototype._mouseCapture.apply(b,arguments)})}a.ui.mouse.prototype._mouseInit.apply(this,arguments)},_mouseCapture:function(b){this.element.parent().attr("aria-valuenow",this.value());if(this.options.dragFill)if(b.target.className==="ui-slider-range ui-widget-header"){this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();return true}else return a.ui.slider.prototype._mouseCapture.apply(this,arguments);else return a.ui.slider.prototype._mouseCapture.apply(this,arguments)},_dragFillTarget:false,_dragFillStart:0,_rangeValue:0,_oldValue1:0,_oldValue2:0,_oldX:0,_oldY:0,_mouseStart:function(a){if(this.options.dragFill){if(a.target)if(a.target.className==="ui-slider-range ui-widget-header"){this._dragFillTarget=true;this._rangeValue=this.values(1)-this.values(0);this._oldValue1=this.values(0);this._oldValue2=this.values(1);this._oldX=a.pageX;this._oldY=a.pageY;return true}this._dragFillTarget=false}return true},_mouseDrag:function(f){var d,c,e,b,g,h;if(this.options.dragFill){d=f.pageX-this._oldX;c=this.element.outerWidth();if(this.options.orientation==="vertical"){c=this.element.outerHeight();d=-(f.pageY-this._oldY)}e=(this.options.max-this.options.min)/c*d;if(this._dragFillTarget){if(this.options.orientation==="vertical")a(document.documentElement).css("cursor","s-resize");else a(document.documentElement).css("cursor","w-resize");if(this._dragFillStart>0){b=this._rangeValue;this.values(0,this._oldValue1+e);this.values(1,this._oldValue1+e+b);g=this.values(0);h=this.values(1);g+b>this.options.max&&this.values(0,this.options.max-b);h-b<this.options.min&&this.values(1,this.options.min+b)}this._dragFillStart++;return false}else return a.ui.slider.prototype._mouseDrag.apply(this,arguments)}else return a.ui.slider.prototype._mouseDrag.apply(this,arguments)},_mouseStop:function(){var b=a.ui.slider.prototype._mouseStop.apply(this,arguments);if(this.options.dragFill){a(document.documentElement).css("cursor","default");window.setTimeout(function(){this._dragFillTarget=false;this._dragFillStart=0},500)}return b}})})(jQuery);